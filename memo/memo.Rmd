---
title: "Project memo"
author: "Team name"
output: github_document
---

This document should contain a detailed account of the data clean up for your data and the design choices you are making for your plots. For instance you will want to document choices you've made that were intentional for your graphic, e.g. color you've chosen for the plot. Think of this document as a code script someone can follow to reproduce the data cleaning steps and graphics in your handout.

```{r load-packages, message = FALSE}
library(tidyverse)
library(broom)
library(lubridate)
library(RColorBrewer)
```

## Data Clean Up Steps for Overall Data

### Step 1: Remove all unused columns

**SHOULD WE COPY PASTE OUR DATA CLEANING FROM THE PROPOSAL?**

### Step 2: ________

```{r loadCSV, message=FALSE}
storms <- read_csv("../data/storms.csv")
```

To put the dates in a more usable format, we split up the format from year month into two columns, year and month.
```{r date_cleanup}
storms <- storms|>
  separate(
    col = BEGIN_YEARMONTH,
    into = c("BEGIN_YEAR", "BEGIN_MONTH"),
    sep = 4,
    convert = TRUE
  )
```

We also change the date format into one that can be graphed with ggplot without any gaps.
```{r change_date_format}
storms <- storms|>
  mutate(BEGIN_DATE = as_date(BEGIN_DATE_TIME))
```


## Plots

### Plot 1: Frequency of storms by year

#### Data cleanup steps specific to plot 1

These data cleaning sections are optional and depend on if you have some data cleaning steps specific to a particular plot

```{r storms_by_year_cleaning}
storms_by_year <- storms|>
  count(BEGIN_YEAR, name = "n_events")

```

#### Final Plot 1

```{r storms_by_year, fig.alt = "A line graph showing the frequency of extreme weather events from 2010-2020. There is a peak at over 18,000 in 2011 and 15,000 in 2018, with no strong trend between other years."}
ggplot(storms_by_year, aes(x = BEGIN_YEAR, y = n_events)) +
  geom_line(linewidth = 1) +
  geom_point(size = 2) +
  labs(
    title = "Frequency of Extreme Weather Events (2010–2020)",
    subtitle = "Filtered to major natural disasters",
    x = "Year",
    y = "Number of Events"
  ) +
  theme_minimal()+
  scale_x_continuous(breaks = c(2010,2012,2014,2016,2018,2020))
#ggsave("storms_by_year.png")
```

### Plot 2: Frequency of storms and fatalities by year

#### Data cleaning for Plot 2

First, we sum the indirect and direct injuries and deaths into one column, casualties, and merge that data frame with the storms by year dataset.

```{r storms_and_injuries_cleaning}
storms_by_year <- storms %>%
  count(BEGIN_YEAR, name = "n_events")

storm_casualties <- storms |> 
  rowwise(EVENT_ID)|>
  mutate(CASUALTIES = sum(c(INJURIES_DIRECT, INJURIES_INDIRECT, DEATHS_DIRECT, DEATHS_INDIRECT)))|>
  group_by(BEGIN_YEAR)|>
  summarise(casualties_year = sum(CASUALTIES))
  
casualties_storms <- left_join(storm_casualties, storms_by_year)
```


```{r total_damage_cost}
#Replace NA with 0
storm_damages <- storms
storm_damages$DAMAGE_PROPERTY[is.na(storm_damages$DAMAGE_PROPERTY)] <- 0
storm_damages$DAMAGE_CROPS[is.na(storm_damages$DAMAGE_CROPS)] <- 0

# Convert crop damage to numeric
storm_damages$CROPS_NUM <- numeric(length(storm_damages$DAMAGE_CROPS))
k_rows <- grepl("K", storm_damages$DAMAGE_CROPS)
storm_damages$CROPS_NUM[k_rows] <- as.numeric(gsub("K", "", storm_damages$DAMAGE_CROPS[k_rows])) / 100

# Convert property damage to numeric
storm_damages$PROP_NUM <- numeric(length(storm_damages$DAMAGE_PROPERTY))
k_rows <- grepl("K", storm_damages$DAMAGE_PROPERTY)
storm_damages$PROP_NUM[k_rows] <- as.numeric(gsub("K", "", storm_damages$DAMAGE_PROPERTY[k_rows])) / 100

#Find total damage cost per year
storm_damages <- storm_damages|>
  rowwise(EVENT_ID)|>
  mutate(DAMAGES = sum(c(PROP_NUM, CROPS_NUM)))|>
  group_by(BEGIN_YEAR)|>
  summarise(damage_year = sum(DAMAGES))

casualties_storms <- left_join(casualties_storms, storm_damages)
```


#### Final Plot 2

```{r storms_and_injuries}
ggplot(casualties_storms, aes(BEGIN_YEAR)) +
  geom_line(aes(y = n_events, color = "orange")) +
  geom_line(aes(y = casualties_year, color = "red"))+
  geom_line(aes(y = damage_year, color = "green"))+
  geom_point(aes(y = n_events, color = "orange")) +
  geom_point(aes(y = casualties_year, color = "red"))+
  geom_point(aes(y = damage_year, color = "green"))+
  labs(
    title = "Frequency of extreme weather events, cost, and injuries (2010–2020)",
    subtitle = "Filtered to major natural disasters",
    x = "Year",
    y = "Number of Events",
    color = ""
  ) +
  theme_minimal()+
  scale_color_manual(
    values = c("orange" = "black", "red" = "red", "green" = "#00cd00"),
    labels = c("orange" = "# of storms",
               "red" = "Injures + Fatalities",
               "green" = "Damages (in $100k)"))+
  scale_x_continuous(breaks = c(2010,2012,2014,2016,2018,2020))
```

### Plot 3: Final Plot 3

```{r}
storms_by_type_year <- storms |>
count(BEGIN_YEAR, EVENT_TYPE, name = "n_events")

ggplot(storms_by_type_year,
aes(x = BEGIN_YEAR,
y = n_events,
fill = EVENT_TYPE)) +
geom_area(alpha = 0.8, position = "stack") +
labs(
title = "Extreme Weather Events by Storm Type (2010–2020)",
subtitle = "Stacked area shows how different storm types contribute to total events",
x = "Year",
y = "Number of Events",
fill = "Storm type"
) +
theme_minimal() +
scale_x_continuous(breaks = c(2010, 2012, 2014, 2016, 2018, 2020)) +
scale_fill_brewer(palette = "Set2")

# ggsave("storms_by_type.png")

```

### Plot 4: ___________ 


Graph Ideas: 

Line graph of all storms by year
stacked line graph by storm type
